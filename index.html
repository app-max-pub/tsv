<link rel="manifest" href="/manifest.webmanifest" />


<a id='load'>open folder</a>

<a id='recent'>open recent</a>

<table>
	<tr>
		<td>
			<div>
				<file-tree></file-tree>
			</div>
		</td>
		<td>
			<div>
				<edit-table></edit-table>
			</div>
		</td>
	</tr>
</table>
<style>
	body {
		overflow: hidden;
		padding: 0;
	}

	table {
		width: 100%;
		height: 90%;
	}


	td {
		vertical-align: top;
	}

	td>div {
		overflow: auto;
	}

	/* file-tree{background: #333;} */
</style>


<script src="https://unpkg.com/dexie@latest/dist/dexie.js"></script>
<script type='module'>
	navigator.serviceWorker.register('sw.js');
	import FS from './fs.js';
	import './dist/edit-table.tag.js';
	import './dist/file-tree.tag.js';
	let file = null;
	let tree = document.querySelector('file-tree');


	var db = new Dexie("FS");
	db.version(1).stores({
		folders: 'name,handle'
	});



	const link = document.getElementById('load');
	link.addEventListener('click', async () => {
		const folder = await window.showDirectoryPicker();
		// localStorage.setItem('folder', folder);
		db.folders.clear();
		db.folders.put({ name: folder.name, handle: folder })
		console.log('folder', folder);

		tree.folder = folder;
		// let list = await FS.loadFolder(folder);
		// console.log('list', list);
		// console.log('readme', list['README.md'])
		return;
		// FS.saveFile(list['README.md'], 'jo man was geht')
	});

	const recent = document.getElementById('recent');
	recent.addEventListener('click', async () => {
		// let folder = localStorage.getItem('folder');
		// console.log('old folder', folder);
		let folders = await db.folders.toArray()
		console.log('last', folders)
		FS.verifyPermission(folders[0].handle);
		tree.folder = folders[0].handle;
	});


	let table = document.querySelector('edit-table');
	table.addEventListener('change', event => {
		console.log('save', file, event.detail)
		FS.saveFile(file, event.detail)
	})


	tree.addEventListener('file', async event => {
		file = event.detail;
		localStorage.setItem('file', file);
		console.log('load', file);
		table.textContent = await FS.loadFile(file);
		// console.log('text', await FS.loadFile(file))
	})

</script>