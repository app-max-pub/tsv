<link rel="manifest" href="/manifest.webmanifest" />


<a id='load'>open folder</a>

<a id='recent'>open recent</a>

<table>
	<tr>
		<td>
			<div>
				<file-tree></file-tree>
			</div>
		</td>
		<td>
			<div>
				<edit-table></edit-table>
			</div>
		</td>
	</tr>
</table>
<style>
	body {
		overflow: hidden;
		padding: 0;
	}

	table {
		width: 100%;
		height: 90%;
	}


	td {
		vertical-align: top;
	}

	td>div {
		overflow: auto;
	}

	/* file-tree{background: #333;} */
</style>


<!-- <script src="https://unpkg.com/dexie@latest/dist/dexie.js"></script> -->
<script type='module'>

	navigator.serviceWorker.register('sw.js');
	import FS from './fs.js';
	import './dist/edit-table.tag.js';
	import './dist/file-tree.tag.js';

	let tree = document.querySelector('file-tree');
	let table = document.querySelector('edit-table');

	import IDBKV from './idbkv.js';
	IDBKV.then(DATA => {
		// console.log('5',DATA.heinz5)
		// DATA.heinz5 = { name: 'walter5' }
		// console.log('save now')
		// DATA.heinz2 = { name: 'walter3' }
		// DATA.heinz = { name: 'walter' }
		// console.log('nach',DATA.heinz.name)
		// setTimeout(() => DATA.heinz.birth = '2020', 500)

		document.getElementById('load').addEventListener('click', async () => {
			const folder = await window.showDirectoryPicker();
			DATA.folder = folder;
			// db.folders.clear();
			// db.folders.put({ name: folder.name, handle: folder })
			console.log('folder', folder);

			tree.folder = folder;
		});

		document.getElementById('recent').addEventListener('click', async () => {
			// let folder = localStorage.getItem('folder');
			// console.log('old folder', folder);
			// let folders = await db.folders.toArray()
			// let folder = DATA.folder
			console.log('last', DATA.folder, DATA.file)
			FS.verifyPermission(DATA.folder);
			tree.folder = DATA.folder;
			// console.log('try file now')
			// FS.verifyPermission(DATA.file);
			// table.textContent = await FS.loadFile(DATA.file);
		});


		table.addEventListener('change', event => {
			console.log('save', DATA.file, event.detail)
			FS.saveFile(DATA.file, event.detail)
		})


		tree.addEventListener('file', async event => {
			DATA.file = event.detail;
			// localStorage.setItem('file', file);
			console.log('load', DATA.file);
			table.textContent = await FS.loadFile(DATA.file);
			// console.log('text', await FS.loadFile(file))
		})

	})

	// DATA.save();
	// let file = null;



	// var db = new Dexie("FS");
	// db.version(1).stores({
	// 	folders: 'name,handle'
	// });








</script>